{% if ansible_system == "Linux" and is_wsl %}
# SSH Agent Bridge for WSL
export SSH_AUTH_SOCK=$HOME/.ssh/agent.sock
if ! ss -a | grep -q $SSH_AUTH_SOCK; then
    mkdir -p ~/.ssh
    chmod 700 ~/.ssh
    rm -f $SSH_AUTH_SOCK
    (setsid socat UNIX-LISTEN:$SSH_AUTH_SOCK,fork EXEC:"/usr/local/bin/npiperelay.exe -ei -s //./pipe/openssh-ssh-agent",nofork &) >/dev/null 2>&1
fi
{% elif ansible_system == "Darwin" %}
# macOS SSH Agent (using system ssh-agent)
if [ -z "$SSH_AUTH_SOCK" ]; then
    eval "$(ssh-agent -s)"
fi
{% endif %}

# Set Neovim as default editor
export EDITOR={{ editor | default('nvim') }}
export VISUAL={{ editor | default('nvim') }}

# Editor aliases
alias vi={{ editor | default('nvim') }}
alias vim={{ editor | default('nvim') }}

# Platform specific aliases
{% if ansible_system == "Linux" %}
alias ll='ls -alF'
alias la='ls -A'
alias l='ls -CF'
{% elif ansible_system == "Darwin" %}
alias ll='ls -alFG'
alias la='ls -AG'
alias l='ls -CFG'
{% endif %}
